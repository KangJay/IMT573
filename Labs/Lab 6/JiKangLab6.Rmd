---
title: "Lab 6"
author: "Ji H. Kang"
date: "11/4/2020"
output: html_document
---

# 1 Simulations 
For this lab, we'll be computing the confidence intervals for the difference of two means. Specifically, this will use the AirBnB listings data for 0 and 1 BR listings in Beijing. Second, we'll simulate a large number of prices from a common distribution and compare the difference of the simulated prices. 

```{r, message=FALSE}
library(ggplot2)
library(tidyverse)
```

```{r}

```

```{r}

listings <- read.delim("../../Data/airbnb-beijing-br01.csv.bz2")
#Conducting experiment on 0 bedroom and 1 bedroom listings. Separated dataset into respective portions. 
br0 <- listings %>% #br0 means 0 bedroom
  filter(bedrooms == 0) %>% 
  select(price) # Don't need bedroom variable after this step. br0 and br1 signify it. 

br1 <- listings %>% #br1 means 1 bedroom
  filter(bedrooms == 1) %>% 
  select(price) 
cat("The max price of a 0 bedroom listing is: $", max(br0$price), ", min value is: $", min(br0$price), "\n", sep="")
cat("The max price of a 1 bedroom listing is: $", max(br1$price), ", min value is: $", min(br1$price), "\n", sep="")
```

## Comparing mean price for 0 bedroom and 1 bedroom listings
```{r}
cat("The mean price of 0 bedroom listings is: $", round(mean(br0$price), 2), "\n", sep="")
cat("The mean price of 1 bedroom listings is: $", round(mean(br1$price), 2), "\n", sep="")
```
Although close, the average price of 1 bedroom listings is higher. 

## How many listings are there for both?
```{r}
N0 <- nrow(br0)
N1 <- nrow(br1) 
cat("There are ", N0, " listings for 0 bedroom\n", sep="")
cat("There are ", N1, " listings for 1 bedroom\n", sep="")
```
## What is the mean and standard deviation overall?
```{r}
mu <- mean(listings$price) 
sd <- sd(listings$price) 
cat("The mean of all the listings is $", round(mu, 2), "\n", sep="")
cat("the standard deviation of all the listings is $", round(sd, 2), "\n", sep="")
```
## Creating fake listings for both 0 and 1 bedroom listings
```{r}
fbr0 <- rnorm(N0, mean=mu, sd=sd) # fbr0 = fake br0
fbr1 <- rnorm(N1, mean=mu, sd=sd) # fbr1 = fake br0
```

### Calculating mean differences of 0 and 1 bedroom listings
```{r}
mean_diff <- mean(br1$price) - mean(br0$price) 
cat("The mean difference of fake bedroom listings is: ", mean(fbr1) - mean(fbr0), "\n", sep="")
cat("The mean difference of real bedroom listings is: ", mean_diff, "\n", sep="")
```
Since the value of fake bedrooms will change each time this experiment is run, I'll be approximating. In this experiment, the mean difference of the fake of 1 and 0 bedroom listings is ~-2.77 while the difference of real 1 and 0 bedroom listings is ~10.29. It's shown that the price difference for fake bedroom listings is lower in magnitude than the real listings. 

### Repeating the experiment 10,000 times and graphing
```{r}
sim <- function(x) {
  fbr0 <- rnorm(N0, mean=mu, sd=sd) 
  fbr1 <- rnorm(N0, mean=mu, sd=sd)
  mean(fbr1) - mean(fbr0)
}
diffs <- sapply(1:10000, sim) 
hist(diffs, breaks=30, col="lightblue")
```
### What are the 0.025 quantiles and 0.975 quantiles?
```{r}
cat("The confidence interval is:\n")
quantile(diffs, c(0.025, 0.975))
```
The actual value calculated before was `r mean_diff`. This falls within the confidence interval. 




