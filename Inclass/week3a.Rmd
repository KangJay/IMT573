---
title: "Week3a"
author: "Ji H. Kang"
date: "10/12/2020"
output: html_document
---

# First read data 
```{r}
gsa <- read.delim("../data/GSAF5.csv.bz2")
names(gsa)
```

Traditional filtering/other operations 
```{r}
gsa[gsa$Year == 2000,]
```

# 1. Pipe operator
```{r, message=FALSE}
library(dplyr)
#Takes the output of the previous function and feeds it into the following function. 
print(sqrt(2)) 
#Vs something like... 
2 %>% sqrt() %>% print()
```

## Exercise: 
Compute and print mean of 1, 2, 3, and 4 using pipes! 
```{r}

1:4 %>% mean() %>% print()
```

# dplyr library 
* select: select _variables_ 
* filter: filter _observations_
* mutate: compute on observation basis
* arrange: order 
* summarize: collapse many observations into a few figures  

## select verb 
```{r}
gsa %>% 
  select(Year, Country, Type, Fatal..Y.N.) %>%
  head(10)
```

## Filtering 
```{r}
gsa %>%
  select(Date:Country, Fatal..Y.N.) %>% 
  filter(tolower(Country) == "australia") %>% 
  head(10)
```

### Exercise: 
Filter out China and Taiwan only. Use 'x %in% c("a", "b")' to select two (or more) countries 
```{r}
gsa %>% 
  select(Date:Country, Fatal..Y.N.) %>% 
  filter(!tolower(Country) %in% c("china", "taiwan")) %>%
  filter(!is.na(Year)) %>%
  arrange(Year) %>% 
  tail(10)
```

### Exercise: 
Descending in year 
```{r}
gsa %>% 
  select(Date:Country, Fatal..Y.N.) %>% 
  filter(!tolower(Country) %in% c("china", "taiwan")) %>%
  filter(!is.na(Year)) %>%
  arrange(desc(Year), Country) %>% 
  head(10)
```
# Summarize
```{r}
gsa %>% 
  filter(!is.na(Year)) %>%
  summarize(min = min(Year), avg = mean(Year), max = max(Year))
```


# Grouped Operations 
* Split data into groups 
* Imagine groups are independent 
* summarize puts these summaries together 
```{r}
gsa %>% 
  filter(!is.na(Year)) %>% #Remove missing years
  filter(Country != "") %>% #Remove empty country names 
  group_by(Country) %>% 
  #Now do this separately for each country
  summarize(min = min(Year)) %>%
  head(10)
```


