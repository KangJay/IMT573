---
title: "Problem Set 5"
author: "Ji H. Kang"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: html_document
---

```{r load_libraries, message=FALSE}
library(tidyverse) 
library(ggplot2)
```
# Problem Set 5: Inference and Monte Carlo Simulations
For this problem set, we'll be utilizing the "fathersons" data. 

## 1. Are Sons Taller than Fathers? 

### 1.1 Descriptive Analysis 
```{r}
fathersons <- read.delim("../../Data/fatherson.csv.bz2")
cat("Number of missing observations for son's height:", sum(is.na(fathersons$sheight)), "\n")
cat("Number of missing observations for father's height:", sum(is.na(fathersons$fheight)), "\n")
```
It's shown that there are no missing observations from this dataset.
```{r}
# Stored values in-case I needed to do some testing on them specifically but it didn't seem like it. 
# Kept them for debugging purposes. Variables are NOT needed. 
f_mean <- mean(fathersons$fheight) 
s_mean <- mean(fathersons$sheight) 
f_median <- median(fathersons$fheight) 
s_median <- median(fathersons$sheight) 
f_sd <- sd(fathersons$fheight) 
s_sd <- sd(fathersons$sheight) 
cat("Mean of fathers' heights is:", f_mean, "cm.\n")
cat("Mean of sons' heights is:", s_mean, "cm.\n----------------------------------\n")
cat("Median of fathers' height is:", f_median, "cm.\n")
cat("Median of sons' height is:", s_median, "cm.\n----------------------------------\n")
cat("Standard deviation of fathers' height is:" , f_sd, "cm.\n")
cat("Standard deviation of sons' height is:", s_sd, "cm.\n")
cat("The range of fathers' heights is:", max(fathersons$fheight) - min(fathersons$fheight), "cm.\n")
cat("The range of sons' heights is:", max(fathersons$sheight) - min(fathersons$sheight), "cm.\n")
```
It's evident that sons, on average, have a higher height than fathers. This can be shown with sons having a mean height of 174.4572 cm with fathers having a mean of 171.9252 cm.\
One thing to note is that the sons height have a wider range (50.4 cm) versus that of fathers who have a range of (41.7cm). This, along with the standard deviation of sons being ~7.15 cm and fathers with 6.97 cm, shows that fathers tend to be more tightly clustered together in terms of their heights with sons having a slightly wider spread. 

### Graphical Comparison
```{r data manipulation}
# To make graphing easier, I manipulated the data to add a title value.
# I essentially made each column into their own respective rows and added a "title" column for father or son values.
sons <- data.frame(fathersons$sheight)
sons['title'] = "son"
names(sons)[1] <- "height"
fathers <- data.frame(fathersons$fheight)
fathers['title'] = "father" 
names(fathers)[1] <- "height"
new_fathersons <- rbind(sons, fathers)
#Using this title value, I can graph both on the same figure. 
```
```{r density graph}
ggplot(new_fathersons, aes(x=height, col=title)) + 
  stat_density(aes(x=height)) + 
  labs(title="Density Graph of Fathers' and Sons' Heights", x="Heights (cm)", y="Density")
```


Looking at the density graph of both fathers and sons and their respective heights, it reaffirms my earlier statement. Because the range of heights as well as the standard deviation for sons was larger than the fathers, I stated that the fathers heights are much more clustered together than sons. This is shown in this visual showing that the fathers had a much higher peak in their density graph meaning that many fathers tend to have heights that differ less from each other than their sons do.\
The distribution for both fathers and sons heights resemble a normal distribution. Since this is a density graph, it just shows that fathers have a tighter clustering in their heights than sons do. The mean values calculated show that sons, on average, are taller than fathers but this graph does not provide that insight. 
```{r}
mean_diff <- mean(fathersons$sheight) - mean(fathersons$fheight)
cat("Sons are", round(mean_diff, 2), "cm taller than fathers on average.\n")
```

### 1.2 Monte Carlo Approach
To see if that there is statistical significance in sons being typically taller than their fathers, we'll be conducting more experiments. 
```{r}
#o_mean = overall mean, o_sd = overall standard deviation
o_mean <- mean(new_fathersons$height) # Values calculated prior 
o_sd <- sd(new_fathersons$height)
cat("The overall mean of the data is:", o_mean, "cm.\n")
cat("The overall standard deviation of the data is:", o_sd, "cm.\n")
```
Now that we have the overall _mean_ and overall _standard deviation_, we'll be making two sets of random normal using the values we calculated just now. 
```{r}
set.seed(1)
fakefathers <- rnorm(5, mean=o_mean, sd=o_sd)
fakesons <- rnorm(5, mean=o_mean, sd=o_sd)
real_mean_dif <- mean(sons$height) - mean(fathers$height)
cat("The difference in mean heights of these fake sets is:", mean(fakefathers) - mean(fakesons), "cm.\n")
```
In this specific instance, the difference is -0.042 cm. This is much lower than the one we've calculated for the actual data (Was ~2.5 cm). It could be explained by the fact that both sets (fakefathers and fakesons) are using the same mean and standard deviation.\
We'll be repeating this experiment 10,000 times to be sure. 
```{r}
sim <- function(x) {
  #Create random distributions of size nrow(fathersons) (approx 1078 observations)
  mean(rnorm(nrow(fathersons), mean=o_mean, sd=o_sd)) - mean(rnorm(nrow(fathersons), mean=o_mean, sd=o_sd))
}
diffs <- sapply(1:10000, sim)
```

```{r}
cat("The mean of differences is:", mean(diffs), "cm.\n")
```
The calculated mean of differences is 0.002 cm. Very close to 0. Since both distributions utilize the same mean and same standard deviation, they should have values that are very close to each other. Since we're taking the difference of many values that are essentially the same, the overall difference is close to 0. 
```{r}
cat("The standard deviation of the differences is:", sd(diffs), "cm.\n")
```
The standard deviation here is ~0.3 cm. This is very small compared to the previous values of ~6.9 cm and 7.1 cm of the fathers and sons respectively.
```{r}
max(diffs)
min(diffs)
```
The biggest difference that occurred was `r max(diffs)` cm. While this is large compared to the average and standard deviation, it is much lower than the actual difference of 2.5 cm calculated beforehand. 
```{r}
cat("The confidence interval is:\n")
quantile(diffs, c(0.025, 0.975))
```
The actual difference is outside the interval range. It would suggest that 95% of the time, the height differences, **if** fathers and sons are the same height, falls within this confidence interval range. Based on this experiment, I can confidently say sons are taller than fathers. Given that the mean is close to 0 with the confidence interval being ~-0.6 to ~0.6 cm, the actual difference must fall within this range for fathers and sons to be considered the same height. Since it does not, it is statistically significant that sons are taller than their fathers on average. 

# 1.3 t-test 
Calculating the standard error for the difference of means. The standard error is the standard deviation divided by the total number.
```{r}
serror <- sd(diffs)/sqrt(length(diffs))
cat("The standard error computed is:", serror, "\n")
```
Next, we will calculate the t-value.
```{r}
fake_mean_dif <- mean(diffs)
real_diffs <- sons$height - fathers$height
t_value <- (mean(real_diffs) - mean(diffs)) / (sd(real_diffs) / sqrt(nrow(fathersons)))
cat("T value:", t_value, "\n")
```
With a t-value of 11, this is a very large value. Seeing the t-table distribution. Looking for values on the t-table, with a degree of freedom of 1077 (the size of fathersons minus 1), it's becoming apparently that it's increasingly confident. As the two tails values decrease, the confidence of the value increases but with our value (11) being so large, it goes off the table. It is in the realm of 99.9999...% chance of confidence. It seems highly unlikely that a t-value like this occurred by random chance.\
Based on the experiment so far, it seems that the actual difference we see is well outside the range of what's if both father and sons are the same height. With a difference mean of ~2.5cm and with a experimental mean of ~0 cm, with a confidence interval of 95% ranging from roughly ~-0.6cm to ~0.6 cm, as well as a t-value of ~11.7, it's clear that sons and fathers are not of similar height.

